\documentclass[9pt,fleqn,twoside,twocolumn]{stdglobal}

\fancypagestyle{titlepagestyle}{
  \fancyhf{}
  \fancyhead[L]{\footnotesize\itshape Seminar (Illustrative Visualization) 2021/2022}
  % \fancyfoot[C]{\footnotesize\bigskip\thepage/\pageref{LastPage}}
  % \fancyfoot{}
  \fancyfoot[C]{\footnotesize\bigskip\thepage}
  \fancyfoot[RO]{\footnotesize\bigskip\copyright\ Markus Pawellek, \today}
  \renewcommand{\footrulewidth}{0.5pt}
  \renewcommand{\headrulewidth}{0pt}
}

\fancypagestyle{mystyle}{
  \fancyhf{}
  \fancyfoot[C]{\footnotesize\bigskip\thepage}
  \fancyfoot[RO]{\footnotesize\bigskip\copyright\ Markus Pawellek, \today}
  % \fancyhead[LO,RE]{\footnotesize \thetitle} %left
  % \fancyhead[RO,LE]{\footnotesize \theauthor} %right
  % \fancyhead[LO,RE]{\footnotesize \ \smallskip}
  \fancyhead[LE]{\footnotesize\itshape Photic Extremum Lines \smallskip} %right
  \fancyhead[RO]{\footnotesize\itshape Seminar (Illustrative Visualization) 2021/2022\smallskip } %right
  \renewcommand{\headrulewidth}{0.5pt}
  \renewcommand{\footrulewidth}{0.5pt}
}

\usepackage{titlesec}
\titleformat{\section}{\normalfont\bfseries}{\thesection}{1em}{}
\titleformat{\subsection}{\normalfont\small\bfseries}{\thesubsection}{1em}{}

\title{Photic Extremum Lines}
\author{Markus Pawellek}
\date{\today}

\hypersetup{
  pdftex,
  % pdfauthor={Your Name},
  % pdftitle={The Title},
  % pdfsubject={\@title},
  pdfkeywords={Illustrative Visualization; Non-Photorealistic Rendering; Feature Lines; Object-Space Algorithm; Contours; Silhouettes; Suggestive Contours; Photic Extremum Lines; Illumination},
  % pdfproducer={Latex with hyperref},
  % pdfcreator={pdflatex, or other tool}
}

\bibliography{references}

\pagestyle{mystyle}

\begin{document}

\selectlanguage{english}

\thispagestyle{titlepagestyle}

\twocolumn[{\begin{@twocolumnfalse}%
  \begin{center}
    \Large
    \bfseries
    Photic Extremum Lines
  \end{center}%
  %\hfill\rule{0.5\textwidth}{0.5pt}\hfill
  \vspace{1pt}
  \begin{center}
    Markus Pawellek \\
    markus.pawellek@mailbox.org
  \end{center}
  \vspace{1em}
  \begin{center}
    \includegraphics[width=0.24\textwidth,trim={15px 15 15 50},clip]{images/rider.png}
    \hfill
    \includegraphics[width=0.24\textwidth,trim={15px 15 15 50},clip]{images/predator-intro.png}
    \hfill
    \includegraphics[width=0.24\textwidth,trim={15px 15 15 50},clip]{images/werewolf-intro.png}
    \hfill
    \includegraphics[width=0.24\textwidth,trim={15px 15 15 50},clip]{images/dragon-head-contour-pel-toon-shader.png}
  \end{center}
  \vspace{2em}
  \hrule
  \begin{abstract}
    \itshape
    \noindent
    In the field of illustrative visualization, feature lines are essential for conveying the shape of a given object.
    Photic extremum lines (PELs) are a type of feature lines in object space, which are, besides surface geometry and view position, dependent on the illumination.
    In this way, illustrations generated by PELs strongly coincide with line drawings created by hand due to human perception.
    Furthermore, PELs are easily adjustable by switching between lighting models and allow various post-processing techniques for line stylization and shading.
    The algorithm to extract PELs from scenes mainly has to compute up to third-order derivatives for each vertex and may be parallelized.
    Implementations allowing real-time performance exist for the CPU and GPU.
    By comparison to other feature line types, it can be seen that PELs are an effective and flexible tool for scientific illustration.
    \\

    \noindent
    \textbf{Keywords:}
    \parbox[t]{0.8\textwidth}{Illustrative Visualization, Non-Photorealistic Rendering, Feature Lines, Object-Space Algorithm, Contours, Silhouettes, Suggestive Contours, Photic Extremum Lines, Illumination}
  \end{abstract}
  \hrule
  \vspace{3em}
\end{@twocolumnfalse}}]

\section{Introduction}
  Illustrative visualization is the science and art of effectively communicating known aspects of scientific data in an accurate and intuitive way.
  Especially for the rendering of volumetric data sets in medicine, it is a valuable tool to reduce a vast amount of complex information to its essence.
  In this respect, photorealistic rendering techniques are suboptimal because they are not able to efficiently depict features of interest.
  Our knowledge of human cognition shows that, artistic drawings or paintings, in comparison to a photograph of the same scene, seem to be more suitable for communication and more pleasing in visual experience \autocite{xie2007}.
  Therefore non-photorealistic rendering techniques, typically inspired by artistic styles, are used to create such illustrations.
  \autocite{viola2005}%
  \footnote{In this report, citations concerning more than one sentence are given at the end of the respective paragraph.}

  Feature lines represent a given data set as a line drawing to mimic hand-drawn illustrations.
  In such a way, a large amount of information can be communicated in a succinct manner by taking advantage of human visual acuity.
  Used as an abstraction tool in illustrative visualization, feature lines convey the shape of objects much more efficiently compared to a photograph.
  \autocite{xie2007,isenberg2003,viola2005}

  There are many different types of commonly-used feature lines, such as contours \autocite{isenberg2003}, suggestive contours \autocite{decarlo2003}, ridge-valley lines \autocite{ohtake2004}, apparent ridges \autocite{judd2007}, and demarcating curves \autocite{kolomenkin2008}.
  Typically, these only depend on the surface geometry, such as normal and curvature, and possibly the view position.
  However, human perception is highly sensitive to high variations in illumination.
  As a consequence, for conveying the shape of objects according to human perception, feature lines should also depend on the lighting of an object.
  \autocite{xie2007,zhang2011}

  In this report, we present the concept and implementation of photic extremum lines (PELs), one of the first types of feature lines exhibiting a dependency on illumination.
  PELs have been first introduced in \textcite{xie2007} and further developed in \textcite{zhang2010}.
  Strongly inspired by the edge detection techniques for 2D images, they are characterized by a sudden change of illumination on the surface of a 3D object.
  Since their computation is taken out in object space, PELs are flexible and enable further post-processing such as line stylization and shading \autocite{isenberg2003}.
  Furthermore, by manipulating the illumination of an object, the user can take full control to adjust the rendering output and achieve desired illustration results.
  Implementations for PELs can be done for the CPU and GPU, nowadays, achieving real-time performance.
  \autocite{xie2007,zhang2010}

\section{Related Work}
  For the comprehension and implementation of PELs, we also need to rely on several basic techniques and definitions.
  In \textcite{isenberg2003}, we get a thorough classification of feature line types together with recommendations according to the requirements of an application.
  It also describes the general routine for feature line extraction by using subpolygon interpolation which is also used in \textcite{zhang2010} to render PELs.
  Furthermore, a basic but general approach for the hidden line removal for object-space algorithms by using a two-pass rendering with depth buffer testing is provided.
  And additionally, using the above techniques the algorithm for extracting the contours of an object is explained.
  \autocite{isenberg2003}

  The definition of PELs involves up to third-order derivatives of scalar illumination functions given on a triangle mesh.
  Algorithms to correctly estimate curvatures and such derivatives are given in \textcite{rusinkiewicz2004}.
  The main content of this report is based on \textcite{xie2007} which defines PELs and provides a first algorithm and a whole framework to properly generate them.
  Supposable, the algorithm was implemented using the CPU.
  In \textcite{zhang2010}, an improved real-time implementation for PELs on the GPU using the standard graphics pipeline for gradient computations is described.
  Hereby, the authors have used a simpler threshold test and a transformed equation to estimate derivatives for vertices.

  % At this time not used.
  % Use it in conclusions.
  % \autocite{kindlmann2003}
  % \autocite{rusinkiewicz2006}
  % \autocite{kolomenkin2008}

\section{Mathematical Preliminaries}
  \begin{definition}[Mesh Function]
    \[
      \function{f}{S}{\setReal}
    \]
  \end{definition}

  \begin{definition}[(First Fundamental Form Triangle)]
    \[
      \mathrm{I}_{uv} \define
      \begin{pmatrix}
        \norm{u}^2 & \scalarProduct{u}{v} \\
        \scalarProduct{u}{v} & \norm{v}^2
      \end{pmatrix}
    \]
    \[
      \mathrm{I}^{-1}_{uv} = \frac{\adj \mathrm{I}_{uv}}{\det \mathrm{I}_{uv}} =
      \frac{1}{\norm{u}^2\norm{v}^2 - \absolute{\scalarProduct{u}{v}}}
      \begin{pmatrix}
        \norm{v}^2 & -\scalarProduct{u}{v} \\
        -\scalarProduct{u}{v} & \norm{u}^2
      \end{pmatrix}
    \]
  \end{definition}

  \begin{definition}[(Gradient Triangle)]
    \[
      [\nabla f]_{uv} = \mathrm{I}^{-1}_{uv}
      \begin{pmatrix}
        \Delta_u f \\
        \Delta_v f
      \end{pmatrix}
    \]
    \[
      \nabla f =
      \begin{pmatrix}
        u & v
      \end{pmatrix}
      [\nabla f]_{uv}
    \]
  \end{definition}

  \begin{definition}
    \[
      \partial_w f(x) \define \scalarProduct{\nabla f(x)}{w}
    \]
    \[
      \mathscr{D}_f g(x) \define \scalarProduct{\nabla g(x)}{\frac{\nabla f(x)}{\norm{\nabla f(x)}}}
    \]
  \end{definition}

  \begin{figure}
    \centering
    \includegraphics[width=0.6\linewidth,trim={15px 15 15 50},clip]{images/sphere-wireframe.png}
    \caption{Triangulated Meshes}
  \end{figure}

\section{Photic Extremum Lines}

  \begin{figure*}
    \centering
    \begin{subfigure}[b]{0.24\textwidth}
      \centering
      \includegraphics[width=0.95\textwidth,trim={15px 15 15 50},clip]{images/dragon-head-vertex-lighting.png}
      \caption{Illumination φ}
    \end{subfigure}%
    \hfill%
    \begin{subfigure}[b]{0.24\textwidth}
      \centering
      \includegraphics[width=0.95\textwidth,trim={15px 15 15 50},clip]{images/dragon-head-light-variation.png}
      \caption{Variation $\norm{\nabla{φ}}$}
    \end{subfigure}%
    \hfill%
    \begin{subfigure}[b]{0.24\textwidth}
      \centering
      \includegraphics[width=0.95\textwidth,trim={15px 15 15 50},clip]{images/dragon-head-light-variation-slope.png}
      \caption{Variation Slope $\mathscr{D}_φ\norm{\nabla φ}$}
    \end{subfigure}%
    \hfill
    \begin{subfigure}[b]{0.24\textwidth}
      \centering
      \includegraphics[width=0.95\textwidth,trim={15px 15 15 50},clip]{images/dragon-head-pel-shader.png}
      \caption{PELs}
    \end{subfigure}%
    \caption{%
      \textbf{Variation}\\
      These images show the same shaded object (dragon head) to visually explain the definition of PELs.
    }
    \label{fig:pel-definition-visualization}
  \end{figure*}

  For this section, let $S$ be a smooth surface patch and $\function{φ}{S}{\setReal}$ three-times continuously differentiable scalar illumination function.

  In other words, photic extrema are points where the variation of illumination in the direction of its gradient reaches a local maximum.

  \begin{definition}[(Photic Extremum Lines)]
    The set $\mathrm{PEL}(S,φ)$ of photic extremum lines consists of all points $x\in S$ such that the following holds.
    \[
      \mathscr{D}_φ\norm{\nabla φ}(x) = 0
      \separate
      \mathscr{D}^2_φ\norm{\nabla φ}(x) < 0
    \]
    Let $τ\in\setReal^+_0$ be an arbitrary threshold.
    \[
      \mathrm{PEL}_τ(S,φ) \define \set{x\in \mathrm{PEL}(S,φ)}{\norm{\nabla φ}(x) > τ}
    \]
  \end{definition}

\section{Algorithm}
  \subsection{Overview}
    \begin{tcolorbox}[%
      colframe=black,
      colbacktitle=white,
      coltitle=black,
      colback=mathdefback,
      attach boxed title to top center={yshift=-2mm},
      enhanced,
      titlerule=0.1pt,
      boxrule=0.5pt,
      arc=5pt,
      breakable,
      width=\linewidth,
      title=Algorithm
    ]
      \begin{enumerate}
        \item Compute illumination
        \item Compute variation
        \item Compute directional derivative
        \item Compute second-order derivative
        \item Detect line vertices on edges by testing for photic extremum
        \item Trace and filter out lines by using threshold
        \item Render only visible lines by using hidden line removal
      \end{enumerate}
    \end{tcolorbox}

  \subsection{Preprocessing}
    Besides loading the triangle mesh to be rendered with PELs, generating interpolated normals for every vertex have to be computed if they are not already present.
    Here, we refer to standard procedures given by \textcite{max1999} and \textcite{jin2005}.
    Further preprocessing would involve reducing the noise of such normals by using bilateral normal filter.

    For the computation of gradients and directional derivatives on the mesh, local coordinate system and Voronoi weights should be precomputed.
    Additionally, neighboring vertices should be stored for parallelization.

  \subsection{Gradient Computation}
    For each face, compute the constant gradient by using formula in background.
    Transform and rotate this gradient into the local vertex system and accumulate multiplied with Voronoi weight.
    Afterwards iterate over all vertices for normalization.

  \subsection{Line Tracing}
  \subsection{Hidden Line Removal}

  \begin{figure}
    \centering
    \includegraphics[width=\linewidth,trim={15px 15 15 50},clip]{images/subpolygon-lines.png}
    \caption{Sub-Polygon Feature Lines}
  \end{figure}

\section{Implementation}

\section{Results and Comparison}

  \begin{figure*}
      \centering
      \begin{subfigure}[b]{0.24\textwidth}
        \centering
        \includegraphics[width=0.95\textwidth,trim={15px 15 15 50},clip]{images/dragon-head-viewer-shader.png}
        \caption{Illumination}
      \end{subfigure}%
      \hfill%
      \begin{subfigure}[b]{0.24\textwidth}
        \centering
        \includegraphics[width=0.95\textwidth,trim={15px 15 15 50},clip]{images/dragon-head-contours.png}
        \caption{Contours}
      \end{subfigure}%
      \hfill%
      \begin{subfigure}[b]{0.24\textwidth}
        \centering
        \includegraphics[width=0.95\textwidth,trim={15px 15 15 50},clip]{images/dragon-head-contour-pel-shader.png}
        \caption{Contours and PELs}
      \end{subfigure}%
      \hfill
      \begin{subfigure}[b]{0.24\textwidth}
        \centering
        \includegraphics[width=0.95\textwidth,trim={15px 15 15 50},clip]{images/dragon-head-contour-pel-toon-shader.png}
        \caption{Contours, PELs, and Toon}
      \end{subfigure}%
      \caption{\textbf{Short Summary Part}\\
      Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
      tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
      quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
      consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
      cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
      proident, sunt in culpa qui officia deserunt mollit anim id est laborum.}
    \end{figure*}

  \begin{figure}
    \centering
    \begin{subfigure}[b]{0.49\linewidth}
      \centering
      \includegraphics[width=\textwidth,trim={15px 15 15 50},clip]{images/fox-skull-threshold-low.png}
      \caption{Low}
    \end{subfigure}
    \begin{subfigure}[b]{0.49\linewidth}
      \centering
      \includegraphics[width=\textwidth,trim={15px 15 15 50},clip]{images/fox-skull-threshold-mid.png}
      \caption{Mid}
    \end{subfigure}
    \caption{Effect of thresholding}
  \end{figure}

  \begin{figure}
    \centering
    \begin{subfigure}[b]{0.49\linewidth}
      \centering
      \includegraphics[width=\textwidth,trim={15px 15 15 50},clip]{images/cyborg-contour-pel-hidden-shader.png}
      \caption{Off}
    \end{subfigure}
    \begin{subfigure}[b]{0.49\linewidth}
      \centering
      \includegraphics[width=\textwidth,trim={15px 15 15 50},clip]{images/cyborg-contour-pel-shader.png}
      \caption{On}
    \end{subfigure}
    \caption{Two-Pass Rendering for Hidden Line Removal}
  \end{figure}

  \begin{figure}
    \centering
    \begin{subfigure}[b]{\linewidth}
      \centering
      \includegraphics[width=\textwidth,trim={15px 15 15 50},clip]{images/lamborghini-front.png}
      \caption{Front}
    \end{subfigure}
    \begin{subfigure}[b]{\linewidth}
      \centering
      \includegraphics[width=\textwidth,trim={15px 15 15 50},clip]{images/lamborghini-side.png}
      \caption{Side}
    \end{subfigure}
    \caption{Nearly Perfect Line Extraction for Smooth Objects}
  \end{figure}

  \begin{figure}
    \centering
    \begin{subfigure}[b]{0.49\linewidth}
      \centering
      \includegraphics[width=\textwidth,trim={15px 15 15 50},clip]{images/head-contour-pel-shader.png}
      \caption{Contours and PELs}
    \end{subfigure}
    \begin{subfigure}[b]{0.49\linewidth}
      \centering
      \includegraphics[width=\textwidth,trim={15px 15 15 50},clip]{images/head-light-variation.png}
      \caption{Variation}
    \end{subfigure}
    \caption{Erroneous Line Extraction for Noisy Objects}
  \end{figure}

\section{Conclusions}
  PELs are view- and light-dependent feature lines in object space.
  They are characterized by points where the variation of illumination is larger than a given threshold and reaches a local maximum in the direction of its gradient.
  To compute PELs, we therefore have to evaluate up to third-order derivatives of a given illumination function every animation frame.
  This makes PELs computationally much more expensive than other feature line types.
  However, real-time capability can be achieved by GPU implementations.
  And with the provided CPU implementation, we are still able to achieve interactive frame rates.
  Using different lighting techniques, PEL generation can be adjusted and shows similarities to hand-drawn illustrations.
  PEL in conjunction with additional shading techniques, such as contours and toon shading, even more improves the rendered output.

  Comparison to other algorithms.

  For the future, exaggerated shading and automatic thresholding and normal filtering should be used.

\nocite{*}
\AtNextBibliography{\footnotesize}
\printbibliography[heading=bibintoc]

\appendix

\end{document}
